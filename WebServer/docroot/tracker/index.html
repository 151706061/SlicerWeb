<!DOCTYPE html>
<html>
<head>

  <title>Browser tracking for mobile</title>

  <link rel="stylesheet" href="../stylesheets/application.css" />
  <script src='http://code.jquery.com/jquery-2.0.3.min.js'></script>

</head>

<body>

<div id='videos'> </div>

<script>
/* getSources inspired from https://github.com/samdutton/simpl/tree/master/getusermedia */
</script>

<div id="container">

  <h1>Data for tracking</h1>

  <h2>There won't be any picture until you approve the use of the camera(s).</h2>

<script>

'use strict';

// handle browser differences
navigator.getUserMedia = navigator.getUserMedia ||
  navigator.webkitGetUserMedia || navigator.mozGetUserMedia;

// when sources are found
function gotSources(sourceInfos) {
  for (var i = 0; i !== sourceInfos.length; ++i) {
    var sourceInfo = sourceInfos[i];
    if (sourceInfo.kind === 'video') {
      videoStart(sourceInfo.id);
    } else {
      console.log('Some other kind of source: ', sourceInfo);
    }
  }
}

// ask for sources
if (typeof MediaStreamTrack.getSources === 'undefined'){
  alert('This browser does not support MediaStreamTrack.\n\nTry Chrome Canary.');
} else {
  MediaStreamTrack.getSources(gotSources);
}

var videoCount = 0;
// play the video when it's available
function successCallback(stream) {
  videoCount += 1;
  var videoID = "video"+videoCount;
  $('#videos').append('<video id='+videoID+'></video><p>'+videoID+'</p>');
  var videoElement = document.querySelector('#video1');
  videoElement.src = window.URL.createObjectURL(stream);
  videoElement.addEventListener('canplay', function(ev){
    var width = 200;
    var height = videoElement.videoHeight / (videoElement.videoWidth/width);
    videoElement.setAttribute('width', width);
    videoElement.setAttribute('height', height);
  }, false);
  videoElement.play();
}

// or error out
function errorCallback(error){
  console.log('navigator.getUserMedia error: ', error);
}

// entry point for video
function videoStart(videoSource){
  var constraints = {
    video: {
      optional: [{sourceId: videoSource}]
    }
  };
  navigator.getUserMedia(constraints, successCallback, errorCallback);
}

</script>


<span id="orientation"></span>

<script>
  
var orientationLabel = document.getElementById('orientation');
orientationLabel.innerHTML = "<p> listening for orientation events...</p>";

window.addEventListener('deviceorientation', function(e) {
        /* e.alpha, beta: e.beta, gamma: e.gamma */
        var orientationLabel = document.getElementById('orientation');
        orientationLabel.innerHTML = "<p> e = " + e + "</p>";
        orientationLabel.innerHTML += "<p> alpha = " + e.alpha + "</p>";
        orientationLabel.innerHTML += "<p> beta = " + e.beta + "</p>";
        orientationLabel.innerHTML += "<p> gamma = " + e.gamma + "</p>";
        orientationLabel.innerHTML += "<p> absolute = " + e.absolute + "</p>";
}, true);

</script>


  <p>This demo requires Chrome 30 or later.</p>

</div>


</body>
</html>
